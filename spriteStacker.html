<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SpriteStacker</title>
<style>
body{
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100vw;
  height: 100vh;
  background-color: black;
  
}
canvas {
  // border: 2px solid #000;
  background-color: blue;
  //width:calc(100%);
  //height:calc(100%);
}
</style>
</head>

<body>
<canvas id="canvas"></canvas>

<script>

canvas.width=200;
canvas.height=200;
setup = false
function resize(){
  canvas.width=window.innerWidth;
  canvas.height=window.innerHeight;
  W = window.innerWidth;
  H = window.innerHeight;
}
if(!setup){
  setTimeout(function(){
    resize()
    setup=true;
    ///////////////////////////////////////////////////////////////////////////////////////////////
    //MENU BUTTONS
    ///////////////////////////////////////////////////////////////////////////////////////////////
    let x = 0;
    let y = 0;
    let xMod = window.innerWidth/10;
    let yMod = window.innerHeight/15;
  function newStack(){project.init(prompt('layer size?','16'))}
    make_button(x,0,xMod,yMod,0,[255,255,255],[0,0,0],[66,66,66],'new Stack',4,[],newStack);
  function button1(){}
    make_button(x+=xMod,0,xMod,yMod,0,[255,255,255],[0,0,0],[66,66,66],'button2',4,[],button1);
  function button2(){alert('I am button2')}
    make_button(x+=xMod,0,xMod,yMod,0,[255,255,255],[0,0,0],[66,66,66],'button3',4,[],button2);
  function button3(){alert('I am button3')}
    make_button(x+=xMod,0,xMod,yMod,0,[255,255,255],[0,0,0],[66,66,66],'button4',4,[],button3);
  function button4(){alert('I am button4')}
    make_button(x+=xMod,0,xMod,yMod,0,[255,255,255],[0,0,0],[66,66,66],'button5',4,[],button4);
  function button5(){alert('I am button5')}
    make_button(x+=xMod,0,xMod,yMod,0,[255,255,255],[0,0,0],[66,66,66],'button6',4,[],button5);
  function button6(){alert('I am button6')}
    make_button(x+=xMod,0,xMod,yMod,0,[255,255,255],[0,0,0],[66,66,66],'button7',4,[],button6);
  function button7(){alert('I am button7')}
    make_button(x+=xMod,0,xMod,yMod,0,[255,255,255],[0,0,0],[66,66,66],'button8',4,[],button7);
  function button8(){alert('I am button8')}
    make_button(x+=xMod,0,xMod,yMod,0,[255,255,255],[0,0,0],[66,66,66],'button9',4,[],button9);
  function button9(){alert('I am button9')}
    make_button(x+=xMod,0,xMod,yMod,0,[255,255,255],[0,0,0],[66,66,66],'button10',4,[],button10);
  function button10(){alert('I am button10')}
    ///////////////////////////////////////////////////////////////////////////////////////////////
    // COLOR PALETTE
    ///////////////////////////////////////////////////////////////////////////////////////////////
    x = 0;
    y = yMod;
    xMod = window.innerWidth/100*15;
    yMod = window.innerHeight/25;
  make_button(x,y,xMod,xMod,0,[255,255,255],[0,0,0],[66,66,66],'palette',4,[],function(){});
  make_button(x,y+=xMod,xMod/3,xMod/3,0,[255,255,255],[0,0,0],[66,66,66],'pencil',4,[],function(){});
  make_button(x+=xMod/3,y,xMod/3,xMod/3,0,[255,255,255],[0,0,0],[66,66,66],'bucket',4,[],function(){});
  make_button(x+=xMod/3,y,xMod/3,xMod/3,0,[255,255,255],[0,0,0],[66,66,66],'line',4,[],function(){});
    x=0;
  make_button(x,y+=xMod/3,xMod/3,xMod/3,0,[255,255,255],[0,0,0],[66,66,66],'pencil',4,[],function(){});
  make_button(x+=xMod/3,y,xMod/3,xMod/3,0,[255,255,255],[0,0,0],[66,66,66],'bucket',4,[],function(){});
  make_button(x+=xMod/3,y,xMod/3,xMod/3,0,[255,255,255],[0,0,0],[66,66,66],'line',4,[],function(){});
    x=0;
  make_button(x,y+=xMod/3,xMod/4,xMod/3,0,[255,255,255],[0,0,0],[66,66,66],'pencil',4,[],function(){});
  make_button(x+=xMod/4,y,xMod/4,xMod/3,0,[255,255,255],[0,0,0],[66,66,66],'bucket',4,[],function(){});
  make_button(x+=xMod/4,y,xMod/4,xMod/3,0,[255,255,255],[0,0,0],[66,66,66],'line',4,[],function(){});
  make_button(x+=xMod/4,y,xMod/4,xMod/3,0,[255,255,255],[0,0,0],[66,66,66],'line',4,[],function(){});
    project = {
      x:window.innerWidth/100*15+4,
      y:window.innerHeight/15+4,
      width:32,
      height:32,
      layers:[],
      currentLayer:0,
      layerMax:32,
      cX:0,
      cY:0,
      offX:0,
      offY:0,
      gridSize:20,
      data:[],
      init:function(size){
        this.width=size;
        this.height=size;
        this.layerMax=size*3;
        this.data=[];
        this.layers=[];
        
        for (let y = 0; y < this.height; y++) {
          var row = [];
          for (let x = 0; x < this.width; x++) {
            row.push([-1,-1,-1]);
          }
          this.data.push(row);
        };
        for(let l = 0; l < this.layerMax; l++){
          this.layers.push(this.data);
        };
      },
      draw:function(){
        let containerL = window.innerWidth/100*15; // left side of project draw area
        let containerR = window.innerWidth-(window.innerWidth/100*25); // right side of project draw area
        let containerT = window.innerHeight/15;// top of project draw area
        let containerB = window.innerHeight; // bottom of project draw area
        let wide = this.width*this.gridSize; // width of project drawing
        let tall = this.height*this.gridSize;// height of project drawing
        this.offX = ((containerR-containerL)-wide)/2;
        this.offY = ((containerB-containerT)-tall)/2;
        for(let y = 0; y < this.height; y++){
          for(let x = 0; x < this.width; x++){
            // gets color at that cell and sets it for drawing
            if(this.data[x][y][0]>-1){
              draw_set_color(this.data[x][y][0],this.data[x][y][1],this.data[x][y][2])
              draw_rectangle(this.x+(x*this.gridSize)+this.offX, this.y+(y*this.gridSize)+this.offY, this.gridSize, this.gridSize,false,0,0,0)
            }else{
              draw_set_color(255,255,255)
              draw_set_linedash([4,8])
              draw_set_linewidth(1)
              draw_rectangle(this.x+(x*this.gridSize)+this.offX, this.y+(y*this.gridSize)+this.offY, this.gridSize, this.gridSize,true,0,0,0)
              draw_set_linedash([])
            }
          }
        }
        draw_set_color(255,255,255);
        this.cX = snap(mouse_x-this.x-this.offX,this.gridSize);
        this.cY = snap(mouse_y-this.y-this.offY,this.gridSize)
        draw_set_linewidth(3)
        draw_rectangle(this.x+this.cX+this.offX, this.y+this.cY+this.offY, this.gridSize, this.gridSize,true,0,0,0);
        draw_set_color(255,0,0);
        let cWc = (containerL+(containerR-containerL)/2)+4;
        let cHc = (containerT+(containerB-containerT)/2)+4;
        draw_line(0, cHc, containerR, cHc)
        draw_line(cWc, 0, cWc, containerB)
      },
      loop:function(){
        if(inside(mouse_x, mouse_y, this.x+this.offX, this.y+this.offY, this.width*this.gridSize, this.height*this.gridSize, 0, 0, 0)){
          this.gridSize+=wheelDir;
          wheelDir=0;
          let containerH = (window.innerHeight)-(window.innerHeight/15)
          
          this.gridSize = clamp(this.gridSize, 3, containerH/this.height)
          let cellX = this.cX/this.gridSize
          let cellY = this.cY/this.gridSize
          cellX = clamp(cellX, 0, this.width);
          cellY = clamp(cellY, 0, this.height);
          if(mouse_check()){
          if(this.data[cellX][cellY]!=undefined){ this.data[cellX][cellY] = [255,255,255]}
          }
          if( mouse_right_down){
          if(this.data[cellX][cellY]!=undefined){ this.data[cellX][cellY] = [-1,-1,-1]}
          }
          
        }
        this.preview();
        //this.layers[this.currentLayer]=this.data
        
      },
      preview:function(){
        for(let y = 0; y < this.height; y++){
          for(let x = 0; x < this.width; x++){
            // gets color at that cell and sets it for drawing
            if(this.data[x][y][0]>-1){
              draw_set_color(this.data[x][y][0],this.data[x][y][1],this.data[x][y][2])
              let offX = (preview.w-(this.width*preview.scale))/2
              let offY = (preview.h-(this.height*preview.scale))/2
              draw_rectangle(preview.x+(x*preview.scale)+offX, preview.y+(y*preview.scale)+offY, preview.scale, preview.scale,false,0,0,0)
            }
            //draw_rectangle(preview.x+x*preview.scale, preview.y+y*preview.scale, preview.scale, preview.scale,false,0,0,0)
          }
        }
      }
    }
    project.init(16);
    layers = {
      x:window.innerWidth-(window.innerWidth/100*25),
      y:window.innerHeight/15,
      w:window.innerWidth/100*25,
      h:window.innerHeight/2,
      draw:function(){
        drawRoundedRectangle(this.x, this.y, this.w, this.h, 0, [0,0,88], [0,0,0], 4, [])
        let cX = this.x+this.w/2;
        let cY = this.y+this.h/2;
        draw_set_color(255,255,255)
        draw_centered_text(cX,cY, 'LAYER: '+project.currentLayer, text_fit('LAYER: '+project.currentLayer,this.w*0.75), 600)
      },
      loop:function(){
        if(inside(mouse_x, mouse_y, this.x, this.y, this.w, this.h, 0, 0, 0)){
          if(wheelDir!=0){
            project.layers[project.currentLayer]=project.data
            project.currentLayer+=wheelDir;// change current layer
            project.currentLayer = clamp(project.currentLayer, 0, project.layerMax)// clamp layers
            project.data= [];
            for (let y = 0; y < project.height; y++) {
              var row = [];
              for (let x = 0; x < project.width; x++) {
                row.push([-1,-1,-1]);
              }
              project.data.push(row);
            };
            //project.data = project.layers[project.currentLayer]
            wheelDir=0
          }
        }
        
      }
    }
    preview = {
      x:window.innerWidth-(window.innerWidth/100*25),
      y:window.innerHeight/2,
      w:window.innerWidth/100*25,
      h:window.innerHeight/2,
      scale:6,
      draw:function(){
        drawRoundedRectangle(this.x, this.y, this.w, this.h, 0, [88,88,88], [0,0,0], 4, [])
      },
      loop:function(){
        /* */
        if(inside(mouse_x, mouse_y, this.x, this.y, this.w, this.h, 0, 0, 0)){
          this.scale+=wheelDir;
          wheelDir=0;
          this.scale = clamp(this.scale, 1, this.h/project.width)
          
        }
        
      }
    }
    
    
  },100)
}
buttons = [];
COLOR = [0,0,0]
window.onresize = function(event) {
  resize()
};



function start(){
  if(setup){
    
  }
}

function loop(){
  //close window
if(keyboard_check_pressed(vk_escape)){window.close()}
  if(setup){
    project.loop();
    preview.loop();
    layers.loop();
  buttons.forEach(button => {button.loop()});
  }else{
    draw_set_color(255,255,255)
    draw_centered_text(canvas.width/2, canvas.height/2, 'THINKING...', text_fit('THINKING...',canvas.width)*0.9, 900);
  }
}

function draw(){
  if(setup==true){
    project.draw()
    // left panel
    let xMod = window.innerWidth/100*15;
    let yMod = window.innerHeight;
    drawRoundedRectangle(0, 0, xMod, yMod, 0, [255,255,255], [0,0,0], 4, [])
    // right panel
    xMod = window.innerWidth/100*25;
    let x = window.innerWidth-(window.innerWidth/100*25)
    yMod = window.innerHeight/25;
    drawRoundedRectangle(x, 0, xMod, yMod, 0, [255,255,255], [0,0,0], 4, [])
  buttons.forEach(button => {button.draw()});
    layers.draw();
    preview.draw();
    layers.draw();
  }
}







function drawRoundedRectangle(x, y, width, height, radius, backColor, borderColor, borderThickness, borderDashStyle) {if (radius > Math.min(width, height) / 2) {radius = Math.min(width, height) / 2;}draw_set_linedash(borderDashStyle);draw_set_linewidth(borderThickness);ctx.fillStyle = "rgb("+backColor[0]+","+backColor[1]+","+backColor[2]+")";ctx.strokeStyle = "rgb("+borderColor[0]+","+borderColor[1]+","+borderColor[2]+")";ctx.beginPath();ctx.moveTo(x + radius, y);ctx.lineTo(x + width - radius, y);ctx.arcTo(x + width, y, x + width, y + radius, radius);ctx.lineTo(x + width, y + height - radius);ctx.arcTo(x + width, y + height, x + width - radius, y + height, radius);ctx.lineTo(x + radius, y + height);ctx.arcTo(x, y + height, x, y + height - radius, radius);ctx.lineTo(x, y + radius);ctx.arcTo(x, y, x + radius, y, radius);ctx.closePath();ctx.fill();ctx.stroke();draw_set_linedash([]);}


function make_button(x,y,w,h,rad,bacC,borC,txtC,text,bW,bD,onclick){let temp={x:x,y:y,w:w,h:h,rad:rad,hover:false,textCol:txtC,backCol:bacC,borderCol:borC,text:text,onclick:onclick,draw:function(){if(this.hover){drawRoundedRectangle(this.x, this.y, this.w, this.h,this.rad,[111,111,111], this.borderCol, bW, bD);}else{drawRoundedRectangle(this.x, this.y, this.w, this.h,this.rad, this.backCol, this.borderCol, bW, bD);}let tSize = text_fit(this.text,this.w)*0.7;draw_set_color(this.textCol[0],this.textCol[1],this.textCol[2]);draw_centered_text(this.x+this.w/2, this.y+this.h/2, this.text, tSize, 700);},loop:function(){if(inside(mouse_x, mouse_y, this.x, this.y, this.w, this.h, 0, 0, 0)){this.hover=true;if(mouse_check_pressed()){this.onclick();mouse_down = false;mouse_pressed = false;}}else{this.hover=false;}},};buttons.push(temp);}


</script>
<script type='text/javascript' src='engine.js'></script>

</body>
</html>
